<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AutoLog</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #eee;
  padding: 15px;
}

h1, h2, h3 {
  color: #fff;
}

input, select, button, textarea {
  width: 100%;
  margin: 6px 0;
  padding: 8px;
  background: #222;
  color: #fff;
  border: 1px solid #444;
  border-radius: 5px;
}

button {
  background: #0a84ff;
  border: none;
  cursor: pointer;
}

button.danger {
  background: #c0392b;
}

.section {
  border: 1px solid #333;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 6px;
}

label {
  display: block;
  margin: 4px 0;
}
</style>
</head>

<body>

<h1>üöó AutoLog</h1>

<div id="app"></div>

<script>
/* ------------------ DATEN ------------------ */

let daten = JSON.parse(localStorage.getItem("autolog")) || {
  kunden: [],
  settings: {
    stundensatz: 50,
    fluessigkeiten: {
      oel: 10,
      brems: 15,
      kuehl: 8
    }
  }
};

let aktKunde = null;
let aktFahrzeug = null;
let aktRapport = null;

/* ------------------ CHECKLISTEN ------------------ */

const CHECKLISTEN = {
  service: [
    "√ñlwechsel",
    "√ñlfilter ersetzt",
    "Luftfilter ersetzt",
    "Pollenfilter ersetzt",
    "Bremsen vorne gepr√ºft",
    "Bremsen hinten gepr√ºft",
    "Zahnriemen gepr√ºft"
  ],
  mfk: [
    "Licht gepr√ºft",
    "Leuchtweitenregulierung gepr√ºft",
    "Bremsen gepr√ºft",
    "Horn gepr√ºft",
    "Lenkradsperre gepr√ºft",
    "Scheibenwischer gepr√ºft",
    "Auspuff gepr√ºft",
    "Reifen gepr√ºft"
  ],
  reifenwechsel: [
    "Sommerreifen montiert",
    "Winterreifen montiert",
    "Reifendruck gepr√ºft",
    "Radschrauben nachgezogen"
  ]
};

/* ------------------ SPEICHERN ------------------ */

function speichern() {
  localStorage.setItem("autolog", JSON.stringify(daten));
}

/* ------------------ START ------------------ */

start();

function start() {
  const app = document.getElementById("app");
  app.innerHTML = `
    <button onclick="kundeNeu()">‚ûï Neuer Kunde</button>
    <h2>Kunden</h2>
    ${daten.kunden.map((k,i)=>`
      <button onclick="kundeOeffnen(${i})">${k.name}</button>
    `).join("")}
  `;
}

/* ------------------ KUNDEN ------------------ */

function kundeNeu() {
  const name = prompt("Name Kunde:");
  if (!name) return;

  daten.kunden.push({
    name: name,
    fahrzeuge: []
  });

  speichern();
  start();
}

function kundeOeffnen(i) {
  aktKunde = daten.kunden[i];
  const app = document.getElementById("app");

  app.innerHTML = `
    <h2>${aktKunde.name}</h2>
    <button onclick="fahrzeugNeu()">‚ûï Fahrzeug</button>
    <button class="danger" onclick="kundeLoeschen(${i})">üóë Kunde l√∂schen</button>
    <hr>
    ${aktKunde.fahrzeuge.map((f,j)=>`
      <button onclick="fahrzeugOeffnen(${j})">
        ${f.marke} ${f.modell} (${f.kennzeichen})
      </button>
    `).join("")}
    <br><br>
    <button onclick="start()">‚¨Ö Zur√ºck</button>
  `;
}

function kundeLoeschen(i) {
  if (!confirm("Kunde inkl. aller Daten l√∂schen?")) return;
  daten.kunden.splice(i,1);
  speichern();
  start();
}

/* ------------------ FAHRZEUGE ------------------ */

function fahrzeugNeu() {
  const marke = prompt("Marke:");
  const modell = prompt("Modell:");
  const kenn = prompt("Kennzeichen:");

  if (!marke || !modell) return;

  aktKunde.fahrzeuge.push({
    marke, modell, kennzeichen: kenn,
    rapporte: []
  });

  speichern();
  kundeOeffnen(daten.kunden.indexOf(aktKunde));
}

function fahrzeugOeffnen(i) {
  aktFahrzeug = aktKunde.fahrzeuge[i];
  const app = document.getElementById("app");

  app.innerHTML = `
    <h2>${aktFahrzeug.marke} ${aktFahrzeug.modell}</h2>
    <button onclick="rapportNeu()">‚ûï Neuer Rapport</button>
    <hr>
    ${aktFahrzeug.rapporte.map((r,ri)=>`
      <button onclick="rapportOeffnen(${ri})">
        ${r.datum} ‚Äì ${r.typ} ‚Äì ${r.total.toFixed(2)} CHF
      </button>
    `).join("")}
    <br><br>
    <button onclick="kundeOeffnen(${daten.kunden.indexOf(aktKunde)})">‚¨Ö Zur√ºck</button>
  `;
}

/* ------------------ RAPPORT ------------------ */

function rapportNeu() {
  aktRapport = {
    datum: new Date().toLocaleDateString(),
    typ: "service",
    km: 0,
    checklist: [],
    stunden: 0,
    fluessigkeiten: {
      oel: 0,
      brems: 0,
      kuehl: 0
    },
    total: 0,
    notiz: ""
  };

  aktFahrzeug.rapporte.push(aktRapport);
  rapportBearbeiten();
}

function rapportOeffnen(i) {
  aktRapport = aktFahrzeug.rapporte[i];
  rapportBearbeiten();
}

function rapportBearbeiten() {
  const app = document.getElementById("app");

  app.innerHTML = `
    <h2>Rapport</h2>

    <label>Kilometerstand</label>
    <input type="number" id="km" value="${aktRapport.km}" oninput="aktRapport.km=this.value">

    <label>Arbeitsart</label>
    <select id="typ" onchange="typGeaendert()">
      <option value="service">Service</option>
      <option value="mfk">MFK</option>
      <option value="reifenwechsel">Reifenwechsel</option>
    </select>

    <div class="section">
      <h3>Checkliste</h3>
      <div id="checkliste"></div>
    </div>

    <div class="section">
      <h3>Arbeitszeit (Std)</h3>
      <input type="number" step="0.1" id="stunden" value="${aktRapport.stunden}" oninput="berechnen()">
    </div>

    <div class="section">
      <h3>Fl√ºssigkeiten (Liter)</h3>
      √ñl <input type="number" step="0.1" id="oel" oninput="berechnen()">
      Bremsfl√ºssigkeit <input type="number" step="0.1" id="brems" oninput="berechnen()">
      K√ºhlmittel <input type="number" step="0.1" id="kuehl" oninput="berechnen()">
    </div>

    <div class="section">
      <h3>Total</h3>
      <strong id="total">0.00 CHF</strong>
    </div>

    <button onclick="rapportSpeichern()">üíæ Speichern</button>
    <button onclick="fahrzeugOeffnen(${aktKunde.fahrzeuge.indexOf(aktFahrzeug)})">‚¨Ö Zur√ºck</button>
  `;

  document.getElementById("typ").value = aktRapport.typ;
  ladeCheckliste();
  berechnen();
}

function typGeaendert() {
  aktRapport.typ = document.getElementById("typ").value;
  aktRapport.checklist = [];
  ladeCheckliste();
}

function ladeCheckliste() {
  const c = document.getElementById("checkliste");
  c.innerHTML = "";

  CHECKLISTEN[aktRapport.typ].forEach(p => {
    const label = document.createElement("label");
    label.innerHTML = `<input type="checkbox"> ${p}`;
    c.appendChild(label);
  });
}

function berechnen() {
  const std = Number(document.getElementById("stunden").value || 0);
  const oel = Number(document.getElementById("oel").value || 0);
  const brems = Number(document.getElementById("brems").value || 0);
  const kuehl = Number(document.getElementById("kuehl").value || 0);

  aktRapport.stunden = std;
  aktRapport.fluessigkeiten.oel = oel;
  aktRapport.fluessigkeiten.brems = brems;
  aktRapport.fluessigkeiten.kuehl = kuehl;

  const total =
    std * daten.settings.stundensatz +
    oel * daten.settings.fluessigkeiten.oel +
    brems * daten.settings.fluessigkeiten.brems +
    kuehl * daten.settings.fluessigkeiten.kuehl;

  aktRapport.total = total;
  document.getElementById("total").innerText = total.toFixed(2) + " CHF";
}

function rapportSpeichern() {
  speichern();
  alert("Rapport gespeichert");
}
</script>

</body>
</html>
